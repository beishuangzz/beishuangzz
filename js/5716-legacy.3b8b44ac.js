"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[5716],{65716:function(e,t,i){i.r(t),i.d(t,{default:function(){return a}});i(74916),i(15306);var o=new(i(54953).Z),t={name:"editOnline",data:function(){return{id:"",onlyShow:!0,filePath:"",fileName:"",userName:"",fileType:"",mySocket:null,resultList:[]}},props:{fileId:{default:""},isOnlyShow:{default:"false"}},methods:{loadFileInfo:function(){var t=this,e=this.id;this.$ajax({method:"get",url:"/law/common/file/loadFileInfo/"+e,successCallback:function(e){t.filePath=e.data.data.FILEPATH,t.fileName=e.data.data.FILENAME,t.userName=e.data.data.USERNAME,t.fileType=e.data.data.FILETYPE,t.loadWebOffice()}})},ShowRevision:function(e){e?o.WebShow(!0):o.WebShow(!1)},SaveDocumentAs:function(){var e=this,t=(document.getElementById("WebOffice2015").style.marginTop="200px",this.id);setTimeout(function(){o.WebSetMsgByName("GETFILEPATH",e.filePath),o.WebSetMsgByName("GETFILENAME",e.fileName),o.WebSetMsgByName("FILEOBJECTID",t),o.FileName=e.fileName,o.FileType=e.fileType,o.FilePath=e.filePath,o.WebSaveLocal()},0)},SaveDocument:function(){var e=this,t=(document.getElementById("WebOffice2015").style.marginTop="200px",this.id);setTimeout(function(){o.WebSetMsgByName("GETFILEPATH",e.filePath),o.WebSetMsgByName("GETFILENAME",e.fileName),o.WebSetMsgByName("FILEOBJECTID",t),o.FileName=e.fileName,o.FileType=e.fileType,o.FilePath=e.filePath,o.WebSave()?(window.opener["returnParent"+t]&&window.opener["returnParent"+t](),o.WebClose(),open(location,"_self").close()):e.$alert(o.Status)},0)},loadWebOffice:function(){initIWebOffice2015(),o.setObj(document.getElementById("WebOffice")),o.ShowTitleBar(!1),o.WebUrl=this.httpCode+"/law/OfficeServer",o.Compatible=!1,o.FileType=this.fileType,o.DebugMode=!1,o.ShowWindow=!0,o.ShowType="1",o.EditType="0","false"==this.onlyShow&&(o.EditType="3"),o.WebSetMsgByName("GETFILEPATH",this.filePath),o.WebSetMsgByName("GETFILENAME",this.fileName),o.FileName=this.fileName,o.UserName=this.userName,o.SetCaption("copyright@2020 天津市道本科技有限公司"),o.obj.WebCreateProcess(),o.WebOpen()&&(o.ShowMenuBar(!1),o.ShowCustomToolbar(!1),"false"!=this.onlyShow&&o.ShowToolBars(!1))},closeButton:function(){o.WebClose(),window.close()}},created:function(){window.saveEditOnline=this.SaveDocument},mounted:function(){var o=this,e=(this.onlyShow=this.$route.params.isOnlyShow||this.isOnlyShow,this.id=this.$route.params.fileId||this.fileId,this.onlyShow),t=this.id,i=window.sessionStorage.getItem("allowEdit");window.onunload=function(){(window.event.screenX-window.screenLeft>document.documentElement.scrollWidth-20&&window.event.clientY<0||window.event.altKey)&&window.sessionStorage.removeItem("allowEdit")},window.opener?"false"==e&&i!=t?this.$alert(this.$t("该附件不允许编辑, 请从系统内重新点击进入"),this.$t("系统提示"),{confirmButtonText:this.$t("确定"),callback:function(e){window.close(),o.$router.replace("/")}}):(document.getElementById("WebOffice2015").style.display="block",setTimeout(function(){var i=o.id;o.$ajax({method:"get",url:"/law/common/file/beforeEdit/"+i,successCallback:function(e){var t="";1==e.data.data.isLock?(o.onlyShow=!0,t="该文档已被锁定，锁定人："+e.data.data.person.personName+"，锁定时间："+e.data.data.time,1==confirm(t)&&o.loadFileInfo()):(e="https:"==document.location.protocol?"wss://":"ws://",o.mySocket=new WebSocket(e+window.location.host+"/fileWS?fileobjectid="+i+"&userid="+o.$route.query.userid),o.mySocket.onopen=function(){setInterval(function(){o.mySocket.send("")},6e4)},o.loadFileInfo())}})},1e3)):this.$alert(this.$t("请从系统内重新点击进入"),this.$t("系统提示"),{confirmButtonText:this.$t("确定"),callback:function(e){window.close(),o.$router.replace("/")}})}},a=(0,i(1001).Z)(t,function(){var t=this,e=t.$createElement,e=t._self._c||e;return e("div",{staticClass:"rel-div"},[e("div",{staticClass:"fileCompare-button"},["false"==t.onlyShow?e("a",{staticClass:"button",attrs:{title:t.$t("保存"),href:"javascript:void(0)"},on:{click:function(e){return t.SaveDocument()}}},[t._v(t._s(t.$t("保存")))]):t._e(),"false"==t.onlyShow?e("a",{staticClass:"button",attrs:{title:t.$t("保存"),href:"javascript:void(0)"},on:{click:function(e){return t.SaveDocumentAs()}}},[t._v(t._s(t.$t("另存为")))]):t._e(),e("a",{staticClass:"button",attrs:{title:t.$t("关闭"),href:"javascript:void(0)"},on:{click:function(e){return t.closeButton()}}},[t._v(t._s(t.$t("关闭"))+" ")])]),e("div",{attrs:{id:"WebOffice2015"}})])},[],!1,null,"fbc13732",null).exports}}]);